---
// src/components/tentang/TeacherCarousel.astro
// Refactored version using modular components

import { sanityClient, urlFor } from '../../lib/sanity';
import Carousel from '../carousel/Carousel.astro';
import CarouselItem from '../carousel/CarouselItem.astro';
import TeacherCard from './TeacherCard.astro';

interface Teacher {
  _id: string;
  name: string;
  position: string;
  subject?: string;
  photo?: any;
  description?: string;
  order?: number;
}

interface Props {
  title?: string;
  subtitle?: string;
}

const {
  title = "Guru & Karyawan",
  subtitle = "Tim profesional yang berdedikasi untuk pendidikan terbaik",
} = Astro.props;

// Fetch teachers from Sanity
let teachers: Teacher[] = [];
try {
  teachers = await sanityClient.fetch(`
    *[_type == "teacher" && isActive == true] | order(order asc) {
      _id,
      name,
      position,
      subject,
      photo,
      description
    }
  `);
} catch (error) {
  console.error('Error fetching teachers:', error);
}

// Fallback data
const defaultTeachers: Teacher[] = [
  {
    _id: "1",
    name: "Drs. H. Ahmad Fauzi, M.Pd",
    position: "Kepala Sekolah",
    description: "Memimpin dan mengkoordinasikan seluruh kegiatan sekolah",
    order: 1
  },
  {
    _id: "2",
    name: "Dra. Siti Nurjanah, M.Pd",
    position: "Wakil Kepala Kurikulum",
    subject: "Bahasa Indonesia",
    description: "Mengatur dan mengembangkan kurikulum sekolah",
    order: 2
  },
  {
    _id: "3",
    name: "Drs. Muhammad Rizki, S.Pd",
    position: "Wakil Kepala Kesiswaan",
    subject: "Pendidikan Agama Islam",
    description: "Membina dan mengembangkan potensi siswa",
    order: 3
  },
  {
    _id: "4",
    name: "Sri Wahyuni, S.Pd",
    position: "Guru Matematika",
    subject: "Matematika",
    description: "Pengajar berpengalaman lebih dari 10 tahun",
    order: 4
  },
  {
    _id: "5",
    name: "John Anderson, B.Ed",
    position: "Native English Teacher",
    subject: "English",
    description: "Mengembangkan kemampuan bahasa Inggris siswa",
    order: 5
  },
  {
    _id: "6",
    name: "Dr. Bambang Sutrisno, M.Sc",
    position: "Guru IPA",
    subject: "Biologi & Kimia",
    description: "Lulusan S3 dengan pengalaman riset internasional",
    order: 6
  },
  {
    _id: "7",
    name: "Fatimah Az-Zahra, S.Pd.I",
    position: "Guru Tahfidz",
    subject: "Al-Qur'an & Tahfidz",
    description: "Hafidzah 30 juz dengan sanad muttashil",
    order: 7
  },
  {
    _id: "8",
    name: "Rudi Hartono, S.Kom",
    position: "Guru TIK",
    subject: "Teknologi Informasi",
    description: "Spesialis programming dan web development",
    order: 8
  }
];

const displayTeachers = teachers.length > 0 ? teachers : defaultTeachers;

// Sort teachers
const sortedTeachers = [...displayTeachers].sort((a, b) => {
  if (a.order !== undefined && b.order !== undefined) {
    return a.order - b.order;
  }
  if (a.position.includes('Kepala Sekolah')) return -1;
  if (b.position.includes('Kepala Sekolah')) return 1;
  return 0;
});

// Get color scheme for variety
type ColorScheme = 'primary' | 'secondary' | 'tertiary';
const getColorScheme = (index: number): ColorScheme => {
  const schemes: ColorScheme[] = ['primary', 'secondary', 'tertiary'];
  return schemes[index % 3];
};
---

<section class="py-16 bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 overflow-hidden">
  <div class="max-w-7xl mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-16">
      <div class="inline-block mb-4 px-4 py-2 bg-primary-100 dark:bg-primary-900/30 rounded-full text-sm font-semibold text-primary-600 dark:text-primary-400">
        ðŸ‘¥ Team
      </div>
      <h2 class="text-3xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">
        {title}
      </h2>
      <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto text-lg">
        {subtitle}
      </p>
    </div>

    <!-- Carousel -->
    <Carousel
      itemCount={sortedTeachers.length}
      showDots={true}
      showArrows={true}
      ariaLabel="Teacher Carousel"
    >
      {sortedTeachers.map((teacher, index) => {
        const colorScheme = getColorScheme(index);
        const imageUrl = teacher.photo 
          ? urlFor(teacher.photo).width(400).height(400).url() 
          : undefined;
        
        return (
          <CarouselItem index={index} className="w-80 md:w-96 group">
            <TeacherCard
              name={teacher.name}
              position={teacher.position}
              subject={teacher.subject}
              photo={imageUrl}
              description={teacher.description}
              colorScheme={colorScheme}
            />
          </CarouselItem>
        );
      })}
    </Carousel>
  </div>
</section>